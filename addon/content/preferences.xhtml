<!--
 * @Author: bodhi
 * @Date: 2025-05-15 20:33:39
 * @LastEditors: bodhi
 * @LastEditTime: 2025-05-17 17:37:24
 * @FilePath: \papers-aync\addon\content\preferences.xhtml
-->
<linkset>
  <html:link rel="localization" href="zoterodifysync-preferences.ftl" />
  <html:link rel="stylesheet" href="chrome://zoterodifysync/content/zoteroPane.css" />
</linkset>
<groupbox
  onload="Zotero.ZoteroDifySync.hooks.onPrefsEvent('load', { window });"
>  
  <!-- Dify API 设置区域 -->
  <groupbox>
    <hbox align="center">
      <html:label
        for="zotero-prefpane-zoterodifysync-dify-api-key"
        data-l10n-id="pref-dify-api-key"
      >API Key:</html:label>
      <html:input
        type="password"
        id="zotero-prefpane-zoterodifysync-dify-api-key"
        preference="dify-api-key"
        style="min-width: 350px;"
      ></html:input>
    </hbox>
    <hbox align="center">
      <html:label
        for="zotero-prefpane-zoterodifysync-dify-base-url"
        data-l10n-id="pref-dify-base-url"
      >服务器 URL:</html:label>
      <html:input
        type="text"
        id="zotero-prefpane-zoterodifysync-dify-base-url"
        preference="dify-base-url"
        placeholder="http://www.orsalab.cn/api/v1"
        style="min-width: 350px;"
      ></html:input>
    </hbox>
    <hbox align="center">
      <html:label
        for="zotero-prefpane-zoterodifysync-dify-kb-id"
        data-l10n-id="pref-dify-kb-id"
      >知识库:</html:label>
      <hbox flex="1">
        <menulist 
          id="zotero-prefpane-zoterodifysync-dify-kb-id"
          preference="dify-kb-id"
          flex="1"
          style="min-width: 300px;"
        >
          <menupopup id="zotero-prefpane-zoterodifysync-dify-kb-list">
            <!-- 这里会动态填充知识库列表 -->
          </menupopup>
        </menulist>
        <button 
          id="zotero-prefpane-zoterodifysync-load-kb"
          label="刷新"
          data-l10n-id="pref-load-kb" 
          oncommand="Zotero.ZoteroDifySync.hooks.onPrefsEvent('loadDifyKnowledgeBases', { window });"
          style="margin-left: 5px;"
        />
      </hbox>
    </hbox>
    <hbox pack="end" style="margin-top: 10px;">
      <button 
        id="zotero-prefpane-zoterodifysync-test-connection"
        label="测试连接"
        data-l10n-id="pref-test-connection" 
        oncommand="Zotero.ZoteroDifySync.hooks.onPrefsEvent('testDifyConnection', { window });"
      />
    </hbox>
    <description id="zotero-prefpane-zoterodifysync-connection-status"></description>
  </groupbox>
</groupbox>
